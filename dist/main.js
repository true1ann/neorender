window.nr=class{static components={};static mountedComponents={};static version="NeoRender Sr3";static verNum=3;static lastError=null;static lastWarn=null;static errorEvent(t){const e=t instanceof Error?t.message:t,n=t instanceof Error?t.stack:null;this.lastError=e;const o={message:this.lastError,stack:n},r=new CustomEvent("neoRenderError",{detail:o});window.dispatchEvent(r)}static warnEvent(t){this.lastWarn=t;const e=new CustomEvent("neoRenderWarn",{detail:this.lastWarn});window.dispatchEvent(e)}static defineComponent(t){try{return t.name&&t.template?(this.components[t.name]=t,!0):(this.errorEvent(new Error("Components must have a Name and a Template.")),!1)}catch(t){return this.errorEvent(t),!1}}static untilVisible(t){return new Promise((e=>{const n=document.querySelector(t);if(!n)return console.error(`Element not found for selector: ${t}`),void e(!1);const o=new IntersectionObserver((t=>{t.forEach((t=>{t.isIntersecting&&(o.unobserve(t.target),e(!0))}))}),{root:null,rootMargin:"0px",threshold:.1});o.observe(n)}))}static async returnComponent(t,e,n){try{const o=this.components[t];if(!o)return this.errorEvent(new Error(`Component ${t} is not defined.`)),!1;let r,i={useShadowRoot:!0,closeShadowRoot:!1,mountConfig:{id:void 0,className:void 0},lazyLoad:!1};if("function"==typeof o.beforeCreate){const t=o.beforeCreate(e,n);i={...i,...t}}const s=document.createElement("div");if(r=i.useShadowRoot?s.attachShadow({mode:i.closeShadowRoot?"closed":"open"}):s,"string"==typeof i.mountConfig.id&&(s.id=i.mountConfig.id),"string"==typeof i.mountConfig.className&&(s.className=i.mountConfig.className),r.innerHTML=o.template,o.scopedStyles&&i.useShadowRoot){const t=document.createElement("style");t.textContent=o.scopedStyles,r.appendChild(t)}return o.scopedStyles&&!i.useShadowRoot&&this.warnEvent(`Component "${o.name}" has scopedStyles, but shadowRoot is disabled. scopedStyles will be ignored.`),"function"==typeof o.main&&o.main(r,e,n),{container:s,config:i,root:r}}catch(t){return this.errorEvent(t),!1}}static async mount(t,e,n){try{const o=this.components[t];if(!o)return this.errorEvent(new Error(`Component ${t} is not defined.`)),!1;const r=document.querySelector(e);if(!r)return this.errorEvent(new Error(`Element ${r} is not found.`)),!1;if(this.mountedComponents[e])return this.mountedComponents[e]===t?(this.warnEvent(`Component ${this.mountedComponents[e]} is already mounted to ${e}`),!0):(this.errorEvent(new Error(`Element ${e} already has a component mounted to it: ${this.mountedComponents[e]}`)),!1);const i=await this.returnComponent(t,n,{type:"mount",mountingTo:e});return i.config.lazyLoad&&await this.untilVisible(e),r.appendChild(i.root),this.mountedComponents[e]=t,"function"==typeof o.afterCreate&&o.afterCreate(i.root,n,{type:"mount",mountingTo:e}),"function"==typeof o.lazyLoad&&(await this.untilVisible(i.config.mount.config.id||e+" > div"),o.lazyLoad(i.root,n,{type:"mount",mountingTo:e})),!0}catch(t){return this.errorEvent(t),!1}}static remount(t,e){try{return document.querySelector(t).innerHTML="",this.mount(e||this.mountedComponents[t],t)}catch(t){return this.errorEvent(t),!1}}static async unmount(t){try{const e=this.mountedComponents[t];if(e){const n=this.components[e];return"function"==typeof n.beforeDelete&&await n.beforeDelete.call(null),document.querySelector(t).innerHTML="",delete this.mountedComponents[t],!0}return this.warnEvent(`Tried to unmount NR from ${t}, but nothing was mounted to it.`),!0}catch(t){return this.errorEvent(t),!1}}static async scriptMount(t,e){try{const n=document.currentScript;if(!n)return this.errorEvent(new Error("scriptMount is NOT meant to be executed in script, or console. use mount/returnComponent instead.")),!1;const o=this.components[t];if(!o)return this.errorEvent(new Error(`Component ${t} is not defined.`)),!1;const r=await this.returnComponent(t,e,{type:"scriptMount",mountingTo:void 0});r.config.lazyLoad&&this.warnEvent(`Component ${t} tried to use full lazyLoading. it is NOT supported by nr.scriptMount`),n.parentNode.replaceChild(r.root,n),"function"==typeof o.afterCreate&&o.afterCreate(r.root,e,{type:"scriptMount",mountingTo:void 0}),"function"==typeof o.lazyLoad&&(r.config.mountConfig.id?(await this.untilVisible(r.config.mountConfig.id),o.lazyLoad(r.root,e,{type:"scriptMount",mountingTo:void 0})):this.warnEvent(`Component ${t} has lazyLoad(), but doesn't have an beforeCreate().mountConfig.id.`))}catch(t){this.errorEvent(t)}}};